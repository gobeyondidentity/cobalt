# Secure Infrastructure - Local Development
#
# Quick start:
#   docker-compose up
#
# This starts the control-plane and host-agent for local development/demo.
# TLS is disabled for simplicity. Do NOT use this configuration in production.

services:
  control-plane:
    image: ghcr.io/gobeyondidentity/secureinfra-control-plane:latest
    container_name: secureinfra-control-plane
    ports:
      - "18080:18080"  # HTTP API
    environment:
      # Logging
      - SECUREINFRA_LOG_LEVEL=debug
      - SECUREINFRA_LOG_FORMAT=text
    volumes:
      - control-plane-data:/var/lib/secureinfra
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost:18080/health"]
      interval: 10s
      timeout: 5s
      retries: 3
      start_period: 5s
    networks:
      - secureinfra

  host-agent:
    image: ghcr.io/gobeyondidentity/secureinfra-host-agent:latest
    container_name: secureinfra-host-agent
    depends_on:
      control-plane:
        condition: service_healthy
    environment:
      # Control plane connection (host-agent reports to control-plane API)
      - DPU_AGENT_URL=http://control-plane:18080
      # Logging
      - SECUREINFRA_LOG_LEVEL=debug
      - SECUREINFRA_LOG_FORMAT=text
    networks:
      - secureinfra

networks:
  secureinfra:
    driver: bridge

volumes:
  control-plane-data:
